<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.31.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">

    <changeSet id="1759711627183-1" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <sequenceExists sequenceName="order_item_seq"/>
            </not>
        </preConditions>
        <createSequence incrementBy="50" sequenceName="order_item_seq" startValue="1"/>
    </changeSet>

    <changeSet id="1759711627183-2" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <sequenceExists sequenceName="order_sequence"/>
            </not>
        </preConditions>
        <createSequence incrementBy="50" sequenceName="order_sequence" startValue="1"/>
    </changeSet>

    <changeSet id="1759711627183-3" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <sequenceExists sequenceName="payment_seq"/>
            </not>
        </preConditions>
        <createSequence incrementBy="50" sequenceName="payment_seq" startValue="1"/>
    </changeSet>

    <changeSet id="1759711627183-4" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="event_publication_archive" columnName="completion_date"/>
            </not>
        </preConditions>
        <createTable tableName="event_publication_archive">
            <column name="id" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_event_publication_archive"/>
            </column>
            <column name="completion_date" type="DATETIME"/>
        </createTable>
    </changeSet>

    <changeSet id="1759711627183-5" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="order_item"/>
            </not>
        </preConditions>
        <createTable tableName="order_item">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_orderitem"/>
            </column>
            <column name="product_id" type="BIGINT"/>
            <column name="quantity" type="INT"/>
            <column name="order_item_total_price" type="DECIMAL"/>
            <column name="order_id" type="BIGINT"/>
            <column name="version" type="INT"/>
            <column name="created_by" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="VARCHAR(255)"/>
            <column name="last_modified_date" type="timestamp"/>
        </createTable>
    </changeSet>

    <changeSet id="1759711627183-6" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="orders"/>
            </not>
        </preConditions>
        <createTable tableName="orders">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_orders"/>
            </column>
            <column name="order_id" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="customer_id" type="BIGINT"/>
            <column name="order_status" type="varchar(20)">
                <constraints nullable="false"/>
            </column>
            <column name="payment_id" type="BIGINT"/>
            <column name="total_price" type="DECIMAL"/>
            <column name="shipping_price" type="DECIMAL"/>
            <column name="version" type="INT"/>
            <column name="created_by" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="VARCHAR(255)"/>
            <column name="last_modified_date" type="timestamp"/>
        </createTable>
    </changeSet>

    <changeSet id="1759711627183-7" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="payment" />
            </not>
        </preConditions>
        <createTable tableName="payment">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_payment"/>
            </column>
            <column name="payment_identifier" type="UUID"/>
            <column name="payment_type" type="varchar(20)">
                <constraints nullable="false"/>
            </column>
            <column name="payment_status" type="varchar(20)">
                <constraints nullable="false"/>
            </column>
            <column name="payment_gateway_name" type="VARCHAR(255)"/>
            <column name="payment_gateway_status" type="VARCHAR(255)"/>
            <column name="payment_gateway_message" type="VARCHAR(255)"/>
            <column name="payment_gateway_error_description" type="VARCHAR(255)"/>
            <column name="customer_id" type="BIGINT"/>
            <column name="version" type="INT"/>
            <column name="card_holder_name" type="VARCHAR(255)"/>
            <column name="card_type" type="VARCHAR(255)"/>
            <column name="card_number" type="VARCHAR(255)"/>
            <column name="expiry_date" type="VARCHAR(255)"/>
            <column name="cvv" type="VARCHAR(255)"/>
            <column name="created_by" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="VARCHAR(255)"/>
            <column name="last_modified_date" type="timestamp"/>
        </createTable>
    </changeSet>

    <changeSet id="1759711627183-8" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <uniqueConstraintExists constraintName="uc_orderitem_product" tableName="order_item"/>
            </not>
        </preConditions>
        <addUniqueConstraint columnNames="product_id" constraintName="uc_orderitem_product" tableName="order_item"/>
    </changeSet>

    <changeSet id="1759711627183-9" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <uniqueConstraintExists constraintName="uc_orders_payment" tableName="orders"/>
            </not>
        </preConditions>
        <addUniqueConstraint columnNames="payment_id" constraintName="uc_orders_payment" tableName="orders"/>
    </changeSet>

    <changeSet id="1759711627183-10" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_ORDERITEM_ON_ORDER"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="order_id" baseTableName="order_item"
                                 constraintName="FK_ORDERITEM_ON_ORDER" referencedColumnNames="id"
                                 referencedTableName="orders"/>
    </changeSet>

    <changeSet id="1759711627183-11" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_ORDERITEM_ON_PRODUCT"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="product_id" baseTableName="order_item"
                                 constraintName="FK_ORDERITEM_ON_PRODUCT" referencedColumnNames="id"
                                 referencedTableName="product"/>
    </changeSet>

    <changeSet id="1759711627183-12" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_ORDERS_ON_CUSTOMER"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="customer_id" baseTableName="orders"
                                 constraintName="FK_ORDERS_ON_CUSTOMER" referencedColumnNames="id"
                                 referencedTableName="customer"/>
    </changeSet>

    <changeSet id="1759711627183-13" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_ORDERS_ON_PAYMENT"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="payment_id" baseTableName="orders"
                                 constraintName="FK_ORDERS_ON_PAYMENT" referencedColumnNames="id"
                                 referencedTableName="payment"/>
    </changeSet>

    <changeSet id="1759711627183-14" author="AJ">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_PAYMENT_ON_CUSTOMER"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="customer_id" baseTableName="payment"
                                 constraintName="FK_PAYMENT_ON_CUSTOMER" referencedColumnNames="id"
                                 referencedTableName="customer"/>
    </changeSet>

</databaseChangeLog>